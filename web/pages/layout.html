<template page>
  <style>
    :host {
      display: block;
      width: 100%;
      height: 100%;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      height: 100%;
    }

    .top {
      margin: 16px 16px 0px 16px;
    }

    .header {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      max-width: none;
      padding: 24px;
      width: 100%;
      text-align: center;
    }

    .main {
      flex: 1;
      overflow-y: auto;
    }
  </style>
  <div class="container">
    <div class="top">
      <s-card class="header">
        <s-button type="text" on:click="goto('./search.html')">
          <h1>{{title}}</h1>
        </s-button>
        <s-segmented-button id="pagetab" mode="auto" on:change="changePage">
          <x-fill :value="pages">
            <s-segmented-button-item>
              {{$data.name}}
            </s-segmented-button-item>
          </x-fill>
        </s-segmented-button>
      </s-card>
    </div>
    <div class="main">
      <slot></slot>
    </div>
  </div>
  <script>
    export default {
      data: {
        title: "ðŸ“‚ bqbq è¡¨æƒ…æ ‡ç­¾",
        pages: [
          { key: "search", name: "æœç´¢", path: "./search.html" },
          { key: "view", name: "æµè§ˆ", path: "./view.html" },
          { key: "tag", name: "æ‰“æ ‡ç­¾", path: "./tag.html" },
          { key: "upload", name: "ä¸Šä¼ ", path: "./upload.html" },
          { key: "manage", name: "æ•°æ®ç®¡ç†", path: "./manage.html" },
        ]
      },
      proto: {
        changePage(event) {
          this.goto(this.pages[event.target.selectedIndex].path);
        },
        refreshActive() {
          const currentPage = this.app.current.src.replace(/.+\/(.+)\.html/, "$1");
          const index = this.pages.findIndex(p => p.key === currentPage);
          const pagetab = this.shadow.$('#pagetab');
          const tabs = pagetab.all('s-segmented-button-item')
          tabs[index].ele.click();
        },
      },
      attached() {
        this.refreshActive();
      },
      routerChange() {
        this.refreshActive();
      },
    };
  </script>
</template>